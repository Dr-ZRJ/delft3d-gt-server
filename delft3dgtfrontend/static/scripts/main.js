"use strict";var UI=function(e){void 0===e&&console.error("No models argument for UI"),this.models=e,this.validateForm()};UI.prototype.getModels=function(){return this.models},UI.prototype.UpdateModelList=function(e){var t=this;if(void 0===e||$.isArray(e)!==!0)return void console.log("not an array");var o=$("#list-model-status tbody"),n="",r=0;$.each(e,function(e,t){var o=t.fields,a={percent_completed:"",time_to_finish:""};null!==o.info&&(o.info=o.info.replace(/'/g,'"'),a=jQuery.parseJSON(o.info)),n+="<tr id='model-"+o.uuid+"' class='"+o.status+"'>",n+="<td>"+o.name+"</td>",n+="<td>"+o.status+" "+a.percent_completed+"</td>",n+="<td>"+a.time_to_finish+"</td>",n+="<td class='column-actions'><button class='btn btn-border btn-small btn-model-delete' data-modelname='"+o.name+"' data-uuid='"+o.uuid+"'><span class='glyphicon glyphicon-remove' ></span></button></td>",n+="</tr>",r++}),o.empty(),o.html(n),o.find(".btn-model-delete").click(function(){var e=$(this).data("uuid"),o=$(this).data("modelname");$("#dialog-remove-name").html(o),$("#dialog-remove-response-accept").on("click",function(){t.getModels().deleteModel({uuid:e},function(){$("#model-"+e).remove(),$("#dialog-confirm-delete").modal("hide")})}),$("#dialog-confirm-delete").modal({})})},UI.prototype.registerHandlers=function(){var e=this;$("#newrun-submit").click(function(){var t={},o={};t.runid=$("#newrun-name").val(),t.author="placeholder",o.timestep=$("#newrun-timestep").val(),e.models.prepareModel(t,o,function(t){void 0!==t&&void 0!==t.status&&("error"===t.status.code&&($("#newrun-alert .alert").html("An error occured! Reason:"+t.status.reason),$("#newrun-alert .alert").removeClass("alert-success").addClass("alert-warning"),$("#newrun-alert").show()),"success"===t.status.code&&($("#newrun-alert .alert").html("Model is starting..."),$("#newrun-alert .alert").removeClass("alert-warning").addClass("alert-success"),$("#newrun-alert").show(),e.models.runModel(t.uuid)),e.models.getModels($.proxy(e.UpdateModelList,e)))})}),$("#run-model-input-properties input").on("change keyup",function(){e.validateForm()})},UI.prototype.validateForm=function(){function e(e){var t=$("#newrun-submit");e===!0?t.removeAttr("disabled"):t.attr("disabled","disabled")}for(var t=new InputValidation,o=[{id:"#newrun-timestep",method:t.ValidateNumberRange},{id:"#newrun-name",method:t.ValidateAsciiString}],n=!0,r=0;r<o.length;r++){var a=o[r],i=$(a.id),d=a.method(i,i.val());d===!1&&(n=!1);var l=i.closest(".input-group");l.toggleClass("error",!d),e(n)}},"undefined"!=typeof module&&module.exports&&(module.exports=UI);var Models=function(){};Models.prototype.setConfiguration=function(e){this.BaseURL=e.BaseURL},Models.prototype.MochaTest=function(e,t){return e+t},Models.prototype.toggleAutoUIRefresh=function(e,t){function o(){-1!==n.refreshTimerId&&(clearInterval(n.refreshTimerId),n.refreshTimerId=-1)}var n=this;t>0?(o(),console.log("Start timer"),n.refreshTimerId=setInterval(function(){n.getModels(e)},t)):o()},Models.prototype.getModels=function(e){var t=this,o=t.BaseURL+"/runs/";$.ajax({url:o}).done(function(t){$("#alert-connectionfailed").hide(),void 0!==e&&e(t)}).error(function(){$("#alert-connectionfailed").show()})},Models.prototype.prepareModel=function(e,t,o){var n=this,r={type:"startrun",name:e.runid,dt:t.timestep};return $.ajax({url:n.BaseURL+"/createrun/",data:r,method:"GET"}).done(function(e){void 0!==o&&o(e)}),!0},Models.prototype.runModel=function(e,t){var o=this;if(void 0!==e){var n={uuid:e};$.ajax({url:o.BaseURL+"/dorun/",data:n,method:"GET",done:function(e){void 0!==t&&t(e)}})}},Models.prototype.deleteModel=function(e,t){var o=this;if(void 0===e)return!1;if(void 0===e.uuid||0===e.uuid.length)return!1;var n={type:"deleterun"};n.parameters={},n.uuid=e.uuid,$.ajax({url:o.BaseURL+"/deleterun/",data:n,method:"GET"}).done(function(e){void 0!==t&&t(e)})},"undefined"!=typeof module&&module.exports&&(module.exports=Models);var InputValidation=function(){};InputValidation.prototype.ValidateNumberRange=function(e,t){var o,n=e.attr("min"),r=e.attr("max");return void 0===n&&(n=0),void 0===r&&(r=0),n>=r&&console.error("Max is <= min"),0!==r&&(o={min:0,max:r}),validator.isInt(t,o)},InputValidation.prototype.ValidateAsciiString=function(e,t){var o=validator.isAscii(t),n=e.attr("maxlength");return void 0!==n&&(o=o&&validator.isLength(t,{min:0,max:n})),o},"undefined"!=typeof module&&module.exports&&(module.exports=InputValidation),function(){var e={BaseURL:""},t=new Models;t.setConfiguration(e);var o=new UI(t);o.registerHandlers(),t.getModels($.proxy(o.UpdateModelList,o)),t.toggleAutoUIRefresh($.proxy(o.UpdateModelList,o),2e4)}();